<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<title>울창한 대나무 숲</title>
<link rel="stylesheet" href="./css/core.css">
<link rel="stylesheet" href="./css/main.css">
</head>
<body>
<!-- 좌측 슬라이드 메뉴바 -->
<div id="aside-bar">
  <button id="close-menu" class="close-btn">닫기</button>
  <button id="signup-menu" class="href-btn">회원가입</button>
</div>

<!-- 메인 영역 -->
<div id="wrap">
  <!-- 상단 헤더 영역 (슬라이드 메뉴바 버튼, 로고) -->
  <div class="header">
      <!-- 고정 메뉴바 -->
      <div class="fixed-bar">
        <button id="show-menu" class="show-btn">목록</button>
        <h2 class="logo">Logo</h2>
        <button id="show-allfeed" class="feed-btn1">모두보기</button>
        <button id="show-fbfeed" class="feed-btn2">대나무숲</button>
        <button id="show-dcfeed" class="feed-btn3">삼육갤</button>
      </div>
  </div>
  <!-- 크롤링한 정보들을 보여줄 콘텐츠 영역 -->
  <div class="section">
    <ul class="all-contents"></ul>
    <ul class="fb-contents"></ul>
    <ul class="dc-contents"></ul>
  </div>
</div>
<!-- JQuery 라이브러리 임포트 -->
<script src="./components/jquery-1.12.0.min.js"></script>
<script src="./components/ajaxsend.js"></script>
<script src="./components/main.js"></script>
<script>
  $('#signup-menu').bind('click', () => {
    window.location.href = '/member';
  });
  let pageCount = (function() {
    let test = 2;
    return test;
  })();
  $(window).on('scroll', function() {
    if($(window).scrollTop() == $(document).height() - $(window).height()) {
      console.log('loading...more feeds');
      // preloader('show') => 로딩 아이콘 보여주기
      // setTimeout(function( preloader('hide'); ), 1000) => AJAX 콜이 성공하면 피드 추가 후, 로딩 아이콘 숨김
      const allContents = $('.all-contents');
      let fn = (result) => {
        for(let i=0; i<result.length; i++) {
          if(result[i].from === 1) {
            allContents.append(`
              <li class="content">
                <h3>삼육대학교 대나무숲</h4>
                <hr>
                <p class="fb-title">${result[i].message}</p>
                <p class="created-time">${result[i].created_time}</p>
              </li>
            `);
          } else {
            allContents.append(`
              <li class="content">
                <h3>디시인사이드</h4>
                <hr>
                <p class="title">${result[i].message}</p>
                <a href="http://gall.dcinside.com${result[i].link}">해당 페이지</a>
                <p class="dc-created-time">${result[i].created_time}</p>
              </li>
            `);
          }
        }
      }
      AJAX.morefeed('http://localhost:3000/dbrender/morefeeds', pageCount, fn);
      pageCount++;
    }
  });
</script>
</body>
</html>
